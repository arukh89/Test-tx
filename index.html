<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TX Battle Royale</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="/icons/icon-192.png">
  <meta property="og:title" content="TX Battle Royale">
  <meta property="og:description" content="BTC Block Prediction Game">
  <meta property="og:image" content="https://1365af1f-d330-4e5d-aa66-aec36a40c958-00-qkni9iz8gb13.picard.replit.dev/og.png">
  <meta property="og:url" content="https://1365af1f-d330-4e5d-aa66-aec36a40c958-00-qkni9iz8gb13.picard.replit.dev">

  <!-- Farcaster Mini App embed -->
  <meta name="fc:miniapp" content='{
    "version": "1",
    "imageUrl": "https://1365af1f-d330-4e5d-aa66-aec36a40c958-00-qkni9iz8gb13.picard.replit.dev/og.png",
    "button": {
      "title": "Open App",
      "action": {
        "type": "launch_frame",
        "name": "TX Battle Royale",
        "url": "https://1365af1f-d330-4e5d-aa66-aec36a40c958-00-qkni9iz8gb13.picard.replit.dev",
        "splashImageUrl": "https://1365af1f-d330-4e5d-aa66-aec36a40c958-00-qkni9iz8gb13.picard.replit.dev/og.png",
        "splashBackgroundColor": "#1a1a1a"
      }
    }
  }'>
</head>
<body>
  <div class="container">
    <header>
      <h1>TX Battle Royale</h1>
      <p class="subtitle">BTC Block Prediction</p>
    </header>

    <p class="status" id="status">Connecting...</p>

    <div class="grid">
      <!-- Battle Arena -->
      <div class="card">
        <h2>Battle Arena</h2>
        <div class="row">
          <button class="cta" id="joinBtn">Join Battle</button>
          <button class="cta" id="shareBtn">Share</button>
          <button class="cta" id="prevBlockBtn">Previous Block</button>
          <button class="cta" id="currBlockBtn">Present Block</button>
        </div>

        <p class="small muted">Your TX guess</p>
        <div class="row">
          <input type="number" id="predictionInput" placeholder="e.g. 2500">
          <button class="cta" id="submitPrediction">Submit Prediction</button>
        </div>

        <p class="small">Players (<span id="playerCount">0</span>)</p>
        <ul id="playerList"></ul>

        <h3>Chat</h3>
        <div class="chatBox" id="chatBox"></div>
        <div class="row">
          <input type="text" id="chatInput" placeholder="Say something...">
          <button class="cta" id="sendBtn">Send</button>
        </div>
      </div>

      <!-- Leaderboard -->
      <div class="card leaderboard">
        <h2>Leaderboard</h2>
        <p class="small" id="userStatus">Signed in as Not signed</p>
        <ul id="leaderboardList"></ul>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/@farcaster/miniapp-sdk/dist/index.umd.js"></script>
  <script>
    // Initialize Farcaster SDK and call ready immediately
    console.log("üé≠ Loading Farcaster SDK...");
    
    if (typeof MiniAppSDK !== 'undefined') {
      window.miniApp = MiniAppSDK;
      console.log("‚úÖ Farcaster SDK loaded successfully");
      
      // Call ready immediately to hide splash screen
      try {
        if (MiniAppSDK.actions && MiniAppSDK.actions.ready) {
          console.log("üöÄ Calling MiniAppSDK.actions.ready()");
          MiniAppSDK.actions.ready();
        }
      } catch (error) {
        console.error("Error calling MiniAppSDK.actions.ready():", error);
      }
    } else {
      console.log("‚ö†Ô∏è MiniAppSDK not available");
      // Signal ready via postMessage as fallback
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'miniapp_ready' }, '*');
      }
    }
  </script>
  <script src="app.js"></script>
</body>
</html>